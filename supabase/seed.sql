-- =============================================
-- Mock Data: สายรหัสตัวอย่าง
-- รันหลัง migrations (supabase db reset จะรันอัตโนมัติ)
-- =============================================

-- ปิด RLS ชั่วคราวเพื่อ seed data
ALTER TABLE public.profiles DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.trees DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.nodes DISABLE ROW LEVEL SECURITY;

-- =============================================
-- 1) Mock User (auth.users → trigger สร้าง profile ให้อัตโนมัติ)
-- =============================================

INSERT INTO auth.users (
    instance_id, id, aud, role, email, encrypted_password,
    email_confirmed_at, created_at, updated_at,
    confirmation_token, recovery_token, email_change_token_new,
    raw_app_meta_data, raw_user_meta_data,
    is_super_admin, last_sign_in_at
) VALUES (
    '00000000-0000-0000-0000-000000000000',
    'a1111111-1111-1111-1111-111111111111',
    'authenticated', 'authenticated',
    'demo@codetree.dev',
    crypt('password123', gen_salt('bf')),
    NOW(), NOW(), NOW(),
    '', '', '',
    '{"provider":"email","providers":["email"]}',
    '{"display_name":"Demo User"}',
    false, NOW()
);

-- ต้องมี identity record ด้วย Supabase ถึงจะยอมให้ login
INSERT INTO auth.identities (
    id, user_id, provider_id, identity_data, provider, last_sign_in_at, created_at, updated_at
) VALUES (
    'a1111111-1111-1111-1111-111111111111',
    'a1111111-1111-1111-1111-111111111111',
    'demo@codetree.dev',
    jsonb_build_object('sub', 'a1111111-1111-1111-1111-111111111111', 'email', 'demo@codetree.dev'),
    'email',
    NOW(), NOW(), NOW()
);

-- อัพเดท profile ให้มีข้อมูลเพิ่ม
UPDATE public.profiles SET
    display_name = 'Demo User',
    university   = 'จุฬาลงกรณ์มหาวิทยาลัย',
    faculty      = 'คณะวิศวกรรมศาสตร์',
    department   = 'ภาควิชาวิศวกรรมคอมพิวเตอร์'
WHERE id = 'a1111111-1111-1111-1111-111111111111';

-- =============================================
-- 2) Mock Tree: สายรหัสวิศวะคอม
-- =============================================

-- Node UUIDs (fixed เพื่อใช้อ้างอิงใน structure)
-- n01 = พี่บอส (root)
-- n02 = พี่มิ้นท์    n03 = พี่เจ       n04 = พี่แนน
-- n05 = น้องแบม     n06 = น้องเฟิร์น   n07 = น้องปลื้ม
-- n08 = น้องกิ๊ฟ    n09 = น้องบีม
-- n10 = น้องมิว     n11 = น้องฟ้า      n12 = น้องอร      n13 = น้องเต้

INSERT INTO public.trees (id, name, description, faculty, department, created_by, is_public, structure)
VALUES (
    'b2222222-2222-2222-2222-222222222222',
    'สายรหัส CE 64',
    'สายรหัสวิศวกรรมคอมพิวเตอร์ รุ่น 64 - 67',
    'คณะวิศวกรรมศาสตร์',
    'ภาควิชาวิศวกรรมคอมพิวเตอร์',
    'a1111111-1111-1111-1111-111111111111',
    true,
    '{
        "rootIds": ["c0000001-0000-0000-0000-000000000001"],
        "edges": {
            "c0000001-0000-0000-0000-000000000001": { "children": ["c0000002-0000-0000-0000-000000000002", "c0000003-0000-0000-0000-000000000003", "c0000004-0000-0000-0000-000000000004"], "order": 0 },
            "c0000002-0000-0000-0000-000000000002": { "children": ["c0000005-0000-0000-0000-000000000005", "c0000006-0000-0000-0000-000000000006"], "order": 0 },
            "c0000003-0000-0000-0000-000000000003": { "children": ["c0000007-0000-0000-0000-000000000007", "c0000008-0000-0000-0000-000000000008"], "order": 1 },
            "c0000004-0000-0000-0000-000000000004": { "children": ["c0000009-0000-0000-0000-000000000009"], "order": 2 },
            "c0000005-0000-0000-0000-000000000005": { "children": [], "order": 0 },
            "c0000006-0000-0000-0000-000000000006": { "children": ["c0000010-0000-0000-0000-000000000010"], "order": 1 },
            "c0000007-0000-0000-0000-000000000007": { "children": ["c0000011-0000-0000-0000-000000000011"], "order": 0 },
            "c0000008-0000-0000-0000-000000000008": { "children": [], "order": 1 },
            "c0000009-0000-0000-0000-000000000009": { "children": ["c0000012-0000-0000-0000-000000000012", "c0000013-0000-0000-0000-000000000013"], "order": 0 },
            "c0000010-0000-0000-0000-000000000010": { "children": [], "order": 0 },
            "c0000011-0000-0000-0000-000000000011": { "children": [], "order": 0 },
            "c0000012-0000-0000-0000-000000000012": { "children": [], "order": 0 },
            "c0000013-0000-0000-0000-000000000013": { "children": [], "order": 1 }
        }
    }'::jsonb
);

-- =============================================
-- 3) Mock Nodes: คนในสายรหัส (13 คน, 4 รุ่น)
-- =============================================

-- โครงสร้าง:
-- รุ่น 64: พี่บอส (root)
-- ├── รุ่น 65: พี่มิ้นท์
-- │   ├── รุ่น 66: น้องแบม
-- │   └── รุ่น 66: น้องเฟิร์น
-- │       └── รุ่น 67: น้องมิว
-- ├── รุ่น 65: พี่เจ
-- │   ├── รุ่น 66: น้องปลื้ม
-- │   │   └── รุ่น 67: น้องฟ้า
-- │   └── รุ่น 66: น้องกิ๊ฟ
-- └── รุ่น 65: พี่แนน
--     └── รุ่น 66: น้องบีม
--         ├── รุ่น 67: น้องอร
--         └── รุ่น 67: น้องเต้

INSERT INTO public.nodes (id, tree_id, nickname, first_name, last_name, student_id, status) VALUES
-- รุ่น 64
('c0000001-0000-0000-0000-000000000001', 'b2222222-2222-2222-2222-222222222222', 'บอส',     'ณัฐพล',   'วงศ์สว่าง',    '6430001021', 'graduated'),
-- รุ่น 65
('c0000002-0000-0000-0000-000000000002', 'b2222222-2222-2222-2222-222222222222', 'มิ้นท์',   'ปิยธิดา',  'แสงจันทร์',    '6530012021', 'graduated'),
('c0000003-0000-0000-0000-000000000003', 'b2222222-2222-2222-2222-222222222222', 'เจ',       'เจษฎา',   'พิทักษ์ธรรม',  '6530045021', 'graduated'),
('c0000004-0000-0000-0000-000000000004', 'b2222222-2222-2222-2222-222222222222', 'แนน',     'กัญญาณัฐ', 'รัตนโชติ',     '6530078021', 'graduated'),
-- รุ่น 66
('c0000005-0000-0000-0000-000000000005', 'b2222222-2222-2222-2222-222222222222', 'แบม',     'ภัทราพร',  'เลิศวิไล',     '6630015021', 'studying'),
('c0000006-0000-0000-0000-000000000006', 'b2222222-2222-2222-2222-222222222222', 'เฟิร์น',   'สุชาดา',   'ศรีสุวรรณ',    '6630023021', 'studying'),
('c0000007-0000-0000-0000-000000000007', 'b2222222-2222-2222-2222-222222222222', 'ปลื้ม',    'ธนกฤต',   'มหาสมุทร',    '6630041021', 'studying'),
('c0000008-0000-0000-0000-000000000008', 'b2222222-2222-2222-2222-222222222222', 'กิ๊ฟ',     'นภัสสร',   'ทองประเสริฐ',  '6630059021', 'studying'),
('c0000009-0000-0000-0000-000000000009', 'b2222222-2222-2222-2222-222222222222', 'บีม',     'พีรพัฒน์',  'จิตรานนท์',    '6630067021', 'studying'),
-- รุ่น 67
('c0000010-0000-0000-0000-000000000010', 'b2222222-2222-2222-2222-222222222222', 'มิว',     'ชนิสรา',   'ภูวนาถ',      '6730008021', 'studying'),
('c0000011-0000-0000-0000-000000000011', 'b2222222-2222-2222-2222-222222222222', 'ฟ้า',      'อภิชญา',   'เมฆสวรรค์',    '6730022021', 'studying'),
('c0000012-0000-0000-0000-000000000012', 'b2222222-2222-2222-2222-222222222222', 'อร',      'กมลชนก',  'วิมลรัตน์',     '6730036021', 'studying'),
('c0000013-0000-0000-0000-000000000013', 'b2222222-2222-2222-2222-222222222222', 'เต้',      'ภูมิพัฒน์', 'สุขสำราญ',     '6730050021', 'studying');

-- เปิด RLS กลับ
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.trees ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.nodes ENABLE ROW LEVEL SECURITY;

-- =============================================
-- สรุป Mock Data:
-- - 1 user:  demo@codetree.dev / password123
-- - 1 tree:  สายรหัส CE 64
-- - 13 nodes: 4 รุ่น (64-67)
-- =============================================
