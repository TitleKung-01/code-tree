{
    "info": {
      "name": "Code Tree API",
      "description": "gRPC (Connect Protocol) API for Code Tree — ระบบจัดสายรหัส",
      "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "variable": [
      {
        "key": "base_url",
        "value": "http://localhost:8080",
        "type": "string"
      },
      {
        "key": "token",
        "value": "PASTE_YOUR_JWT_TOKEN_HERE",
        "type": "string"
      },
      {
        "key": "tree_id",
        "value": "",
        "type": "string"
      },
      {
        "key": "node_id",
        "value": "",
        "type": "string"
      },
      {
        "key": "root_node_id",
        "value": "",
        "type": "string"
      },
      {
        "key": "child_node_id",
        "value": "",
        "type": "string"
      }
    ],
    "auth": {
      "type": "bearer",
      "bearer": [
        {
          "key": "token",
          "value": "{{token}}",
          "type": "string"
        }
      ]
    },
    "item": [
      {
        "name": "Tree Service",
        "item": [
          {
            "name": "1. Create Tree",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "if (pm.response.code === 200) {",
                    "    const res = pm.response.json();",
                    "    if (res.tree && res.tree.id) {",
                    "        pm.collectionVariables.set('tree_id', res.tree.id);",
                    "        console.log('✅ Saved tree_id:', res.tree.id);",
                    "    }",
                    "    pm.test('Tree created successfully', function() {",
                    "        pm.expect(res.tree).to.have.property('id');",
                    "        pm.expect(res.tree.name).to.eql('สายรหัส CE 67');",
                    "    });",
                    "}"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"name\": \"สายรหัส CE 67\",\n  \"description\": \"สายรหัสภาควิชาวิศวกรรมคอมพิวเตอร์ รุ่น 67\",\n  \"faculty\": \"วิศวกรรมศาสตร์\",\n  \"department\": \"วิศวกรรมคอมพิวเตอร์\"\n}"
              },
              "url": {
                "raw": "{{base_url}}/tree.v1.TreeService/CreateTree",
                "host": ["{{base_url}}"],
                "path": ["tree.v1.TreeService", "CreateTree"]
              },
              "description": "สร้าง Tree ใหม่ (สายรหัส)\n\n✅ auto-save tree_id เข้า collection variable"
            }
          },
          {
            "name": "2. List My Trees",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "if (pm.response.code === 200) {",
                    "    const res = pm.response.json();",
                    "    pm.test('Returns array of trees', function() {",
                    "        pm.expect(res).to.have.property('trees');",
                    "        pm.expect(res.trees).to.be.an('array');",
                    "    });",
                    "    pm.test('Has at least 1 tree', function() {",
                    "        pm.expect(res.trees.length).to.be.greaterThan(0);",
                    "    });",
                    "    console.log('✅ Found', res.trees.length, 'trees');",
                    "}"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{}"
              },
              "url": {
                "raw": "{{base_url}}/tree.v1.TreeService/ListMyTrees",
                "host": ["{{base_url}}"],
                "path": ["tree.v1.TreeService", "ListMyTrees"]
              },
              "description": "ดึง Trees ทั้งหมดของ user ที่ login"
            }
          },
          {
            "name": "3. Get Tree",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "if (pm.response.code === 200) {",
                    "    const res = pm.response.json();",
                    "    pm.test('Returns tree object', function() {",
                    "        pm.expect(res).to.have.property('tree');",
                    "        pm.expect(res.tree).to.have.property('id');",
                    "        pm.expect(res.tree).to.have.property('name');",
                    "    });",
                    "    console.log('✅ Got tree:', res.tree.name);",
                    "}"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"id\": \"{{tree_id}}\"\n}"
              },
              "url": {
                "raw": "{{base_url}}/tree.v1.TreeService/GetTree",
                "host": ["{{base_url}}"],
                "path": ["tree.v1.TreeService", "GetTree"]
              },
              "description": "ดึง Tree เดียวด้วย ID\n\nใช้ {{tree_id}} ที่ auto-save จาก Create Tree"
            }
          },
          {
            "name": "4. Get Tree (Not Found)",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "pm.test('Returns not_found error', function() {",
                    "    const res = pm.response.json();",
                    "    pm.expect(res.code).to.eql('not_found');",
                    "});",
                    "console.log('✅ Correctly returned not_found');"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"id\": \"00000000-0000-0000-0000-000000000000\"\n}"
              },
              "url": {
                "raw": "{{base_url}}/tree.v1.TreeService/GetTree",
                "host": ["{{base_url}}"],
                "path": ["tree.v1.TreeService", "GetTree"]
              },
              "description": "ทดสอบ: ดึง Tree ที่ไม่มี → ควรได้ not_found error"
            }
          },
          {
            "name": "5. Create Tree (No Name — Error)",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "pm.test('Returns invalid_argument error', function() {",
                    "    const res = pm.response.json();",
                    "    pm.expect(res.code).to.eql('invalid_argument');",
                    "});",
                    "console.log('✅ Correctly returned validation error');"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"name\": \"\",\n  \"description\": \"ทดสอบไม่มีชื่อ\"\n}"
              },
              "url": {
                "raw": "{{base_url}}/tree.v1.TreeService/CreateTree",
                "host": ["{{base_url}}"],
                "path": ["tree.v1.TreeService", "CreateTree"]
              },
              "description": "ทดสอบ: สร้าง Tree ไม่มีชื่อ → ควรได้ invalid_argument error"
            }
          },
          {
            "name": "6. No Auth Token (401)",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "pm.test('Returns 401 unauthorized', function() {",
                    "    pm.expect(pm.response.code).to.eql(401);",
                    "});",
                    "console.log('✅ Correctly returned 401');"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "auth": {
                "type": "noauth"
              },
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{}"
              },
              "url": {
                "raw": "{{base_url}}/tree.v1.TreeService/ListMyTrees",
                "host": ["{{base_url}}"],
                "path": ["tree.v1.TreeService", "ListMyTrees"]
              },
              "description": "ทดสอบ: ไม่มี Authorization header → ควรได้ 401"
            }
          },
          {
            "name": "7. Delete Tree",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "if (pm.response.code === 200) {",
                    "    pm.test('Tree deleted successfully', function() {",
                    "        pm.expect(pm.response.code).to.eql(200);",
                    "    });",
                    "    console.log('✅ Tree deleted');",
                    "}"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"id\": \"{{tree_id}}\"\n}"
              },
              "url": {
                "raw": "{{base_url}}/tree.v1.TreeService/DeleteTree",
                "host": ["{{base_url}}"],
                "path": ["tree.v1.TreeService", "DeleteTree"]
              },
              "description": "ลบ Tree ด้วย ID\n\n⚠️ CASCADE: nodes ทั้งหมดใน tree จะถูกลบด้วย"
            }
          },
          {
            "name": "8. Create Tree for Day 4",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "if (pm.response.code === 200) {",
                    "    const res = pm.response.json();",
                    "    if (res.tree && res.tree.id) {",
                    "        pm.collectionVariables.set('tree_id', res.tree.id);",
                    "        console.log('✅ Saved tree_id for Day 4:', res.tree.id);",
                    "    }",
                    "}"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"name\": \"สายรหัส CE 68\",\n  \"description\": \"เตรียมไว้สำหรับทดสอบ Node Service\",\n  \"faculty\": \"วิศวกรรมศาสตร์\",\n  \"department\": \"วิศวกรรมคอมพิวเตอร์\"\n}"
              },
              "url": {
                "raw": "{{base_url}}/tree.v1.TreeService/CreateTree",
                "host": ["{{base_url}}"],
                "path": ["tree.v1.TreeService", "CreateTree"]
              },
              "description": "สร้าง Tree ใหม่ไว้ใช้ทดสอบ Node Service ใน Day 4"
            }
          }
        ],
        "description": "Tree CRUD Operations\n\nBase path: /tree.v1.TreeService/"
      },
      {
        "name": "Node Service (Day 4)",
        "item": [
          {
            "name": "1. Create Root Node",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "if (pm.response.code === 200) {",
                    "    const res = pm.response.json();",
                    "    if (res.node && res.node.id) {",
                    "        pm.collectionVariables.set('root_node_id', res.node.id);",
                    "        pm.collectionVariables.set('node_id', res.node.id);",
                    "        console.log('✅ Saved root_node_id:', res.node.id);",
                    "    }",
                    "    pm.test('Node created with generation 1', function() {",
                    "        pm.expect(res.node.generation).to.eql(1);",
                    "    });",
                    "    pm.test('No parent (root node)', function() {",
                    "        pm.expect(res.node.parentId).to.be.undefined;",
                    "    });",
                    "}"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"treeId\": \"{{tree_id}}\",\n  \"nickname\": \"เจมส์\",\n  \"firstName\": \"สมชาย\",\n  \"lastName\": \"ใจดี\",\n  \"studentId\": \"6401001\",\n  \"status\": \"NODE_STATUS_GRADUATED\"\n}"
              },
              "url": {
                "raw": "{{base_url}}/node.v1.NodeService/CreateNode",
                "host": ["{{base_url}}"],
                "path": ["node.v1.NodeService", "CreateNode"]
              },
              "description": "สร้าง Root Node (ไม่มี parent)\n\n→ generation = 1\n→ auto-save root_node_id"
            }
          },
          {
            "name": "2. Create Child Node (น้องรหัส)",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "if (pm.response.code === 200) {",
                    "    const res = pm.response.json();",
                    "    if (res.node && res.node.id) {",
                    "        pm.collectionVariables.set('child_node_id', res.node.id);",
                    "        pm.collectionVariables.set('node_id', res.node.id);",
                    "        console.log('✅ Saved child_node_id:', res.node.id);",
                    "    }",
                    "    pm.test('Node created with generation 2', function() {",
                    "        pm.expect(res.node.generation).to.eql(2);",
                    "    });",
                    "    pm.test('Has correct parent', function() {",
                    "        pm.expect(res.node.parentId).to.eql(pm.collectionVariables.get('root_node_id'));",
                    "    });",
                    "}"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"treeId\": \"{{tree_id}}\",\n  \"parentId\": \"{{root_node_id}}\",\n  \"nickname\": \"มิ้นท์\",\n  \"firstName\": \"สมหญิง\",\n  \"lastName\": \"รักเรียน\",\n  \"studentId\": \"6501001\",\n  \"status\": \"NODE_STATUS_STUDYING\"\n}"
              },
              "url": {
                "raw": "{{base_url}}/node.v1.NodeService/CreateNode",
                "host": ["{{base_url}}"],
                "path": ["node.v1.NodeService", "CreateNode"]
              },
              "description": "สร้าง Child Node (น้องรหัสของ root)\n\n→ parentId = root_node_id\n→ generation = parent.generation + 1 = 2"
            }
          },
          {
            "name": "3. Create Child Node #2 (น้องอีกคน)",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "if (pm.response.code === 200) {",
                    "    const res = pm.response.json();",
                    "    pm.test('Node created with generation 2', function() {",
                    "        pm.expect(res.node.generation).to.eql(2);",
                    "    });",
                    "    console.log('✅ Second child created:', res.node.id);",
                    "}"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"treeId\": \"{{tree_id}}\",\n  \"parentId\": \"{{root_node_id}}\",\n  \"nickname\": \"บีม\",\n  \"firstName\": \"สมศักดิ์\",\n  \"lastName\": \"ตั้งใจ\",\n  \"studentId\": \"6501002\",\n  \"status\": \"NODE_STATUS_STUDYING\"\n}"
              },
              "url": {
                "raw": "{{base_url}}/node.v1.NodeService/CreateNode",
                "host": ["{{base_url}}"],
                "path": ["node.v1.NodeService", "CreateNode"]
              },
              "description": "สร้างน้องรหัสคนที่ 2 ของ root\n\n→ siblings กับ มิ้นท์"
            }
          },
          {
            "name": "4. Create Grandchild (หลาน)",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "if (pm.response.code === 200) {",
                    "    const res = pm.response.json();",
                    "    pm.test('Node created with generation 3', function() {",
                    "        pm.expect(res.node.generation).to.eql(3);",
                    "    });",
                    "    console.log('✅ Grandchild created, gen:', res.node.generation);",
                    "}"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"treeId\": \"{{tree_id}}\",\n  \"parentId\": \"{{child_node_id}}\",\n  \"nickname\": \"นิว\",\n  \"firstName\": \"สมใจ\",\n  \"lastName\": \"เก่งมาก\",\n  \"studentId\": \"6601001\",\n  \"status\": \"NODE_STATUS_STUDYING\"\n}"
              },
              "url": {
                "raw": "{{base_url}}/node.v1.NodeService/CreateNode",
                "host": ["{{base_url}}"],
                "path": ["node.v1.NodeService", "CreateNode"]
              },
              "description": "สร้าง Grandchild (น้องของมิ้นท์)\n\n→ parentId = child_node_id (มิ้นท์)\n→ generation = 3"
            }
          },
          {
            "name": "5. Get Tree Nodes",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "if (pm.response.code === 200) {",
                    "    const res = pm.response.json();",
                    "    pm.test('Returns array of nodes', function() {",
                    "        pm.expect(res).to.have.property('nodes');",
                    "        pm.expect(res.nodes).to.be.an('array');",
                    "    });",
                    "    pm.test('Has 4 nodes', function() {",
                    "        pm.expect(res.nodes.length).to.eql(4);",
                    "    });",
                    "    console.log('✅ Found', res.nodes.length, 'nodes');",
                    "    res.nodes.forEach(n => {",
                    "        console.log(`  - ${n.nickname} (gen ${n.generation})`);",
                    "    });",
                    "}"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"treeId\": \"{{tree_id}}\"\n}"
              },
              "url": {
                "raw": "{{base_url}}/node.v1.NodeService/GetTreeNodes",
                "host": ["{{base_url}}"],
                "path": ["node.v1.NodeService", "GetTreeNodes"]
              },
              "description": "ดึง Nodes ทั้งหมดของ Tree\n\nควรได้ 4 nodes:\n- เจมส์ (gen 1)\n- มิ้นท์ (gen 2)\n- บีม (gen 2)\n- นิว (gen 3)"
            }
          },
          {
            "name": "6. Update Node",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "if (pm.response.code === 200) {",
                    "    const res = pm.response.json();",
                    "    pm.test('Nickname updated', function() {",
                    "        pm.expect(res.node.nickname).to.eql('มิ้นท์ (แก้ไขแล้ว)');",
                    "    });",
                    "    console.log('✅ Node updated:', res.node.nickname);",
                    "}"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"id\": \"{{child_node_id}}\",\n  \"nickname\": \"มิ้นท์ (แก้ไขแล้ว)\",\n  \"firstName\": \"สมหญิง\",\n  \"lastName\": \"รักเรียนมาก\",\n  \"studentId\": \"6501001\",\n  \"status\": \"NODE_STATUS_GRADUATED\"\n}"
              },
              "url": {
                "raw": "{{base_url}}/node.v1.NodeService/UpdateNode",
                "host": ["{{base_url}}"],
                "path": ["node.v1.NodeService", "UpdateNode"]
              },
              "description": "แก้ไขข้อมูล Node\n\nเปลี่ยน nickname + status"
            }
          },
          {
            "name": "7. Move Node (Day 8)",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "if (pm.response.code === 200) {",
                    "    const res = pm.response.json();",
                    "    pm.test('Node moved successfully', function() {",
                    "        pm.expect(res.node).to.have.property('id');",
                    "    });",
                    "    console.log('✅ Node moved, new gen:', res.node.generation);",
                    "}"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"nodeId\": \"{{child_node_id}}\",\n  \"newParentId\": \"{{root_node_id}}\",\n  \"siblingOrder\": 0\n}"
              },
              "url": {
                "raw": "{{base_url}}/node.v1.NodeService/MoveNode",
                "host": ["{{base_url}}"],
                "path": ["node.v1.NodeService", "MoveNode"]
              },
              "description": "ย้าย Node ไปอยู่ใต้ Parent ใหม่\n\n⚠️ จะใช้ได้จริงหลัง Day 8 (MoveNode implementation)"
            }
          },
          {
            "name": "8. Delete Node",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "if (pm.response.code === 200) {",
                    "    pm.test('Node deleted', function() {",
                    "        pm.expect(pm.response.code).to.eql(200);",
                    "    });",
                    "    console.log('✅ Node deleted');",
                    "}"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"id\": \"{{node_id}}\"\n}"
              },
              "url": {
                "raw": "{{base_url}}/node.v1.NodeService/DeleteNode",
                "host": ["{{base_url}}"],
                "path": ["node.v1.NodeService", "DeleteNode"]
              },
              "description": "ลบ Node\n\n⚠️ CASCADE: ถ้า node มีน้อง น้องจะถูก SET NULL (parent_id = null)"
            }
          }
        ],
        "description": "Node CRUD Operations\n\nBase path: /node.v1.NodeService/\n\n⚠️ ต้อง Create Tree ก่อน (tree_id variable ต้องมีค่า)"
      },
      {
        "name": "Health Check",
        "item": [
          {
            "name": "Health Check (Public)",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "pm.test('Server is healthy', function() {",
                    "    pm.expect(pm.response.code).to.eql(200);",
                    "    const res = pm.response.json();",
                    "    pm.expect(res.status).to.eql('ok');",
                    "});",
                    "console.log('✅ Server is healthy');"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "auth": {
                "type": "noauth"
              },
              "method": "GET",
              "url": {
                "raw": "{{base_url}}/health",
                "host": ["{{base_url}}"],
                "path": ["health"]
              },
              "description": "Health check — ไม่ต้อง auth"
            }
          }
        ]
      }
    ]
  }